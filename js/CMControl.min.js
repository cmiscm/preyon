/*
 CM Controller
 Author: Jongmin Kim
 Version: 0.1.0 Beta
 */
var CMControl={};CMControl.isTouch=!!("ontouchstart"in window),CMControl.getCurrent=function(a,b,c,d,e){var f=(e-d)/(c-b)*(a-b)+d;return d<e?f<d?f=d:f>e&&(f=e):f>d?f=d:f<e&&(f=e),f},CMControl.Element=function(){},CMControl.Element.prototype={setClass:function(a){return this.dom.className=a,this},setStyle:function(a,b){for(var c=0;c<b.length;c++)this.dom.style[a]=b[c]},setTextContent:function(a){return this.dom.textContent=a,this},setHTMLContent:function(a){return this.dom.innerHTML=a,this}};var properties=["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","backgroundColor","fontSize","fontWeight","display","overflow","cursor"];properties.forEach(function(a){var b="set"+a.substr(0,1).toUpperCase()+a.substr(1,a.length);CMControl.Element.prototype[b]=function(){return this.setStyle(a,arguments),this}});var events=["MouseOver","MouseOut","Click"];events.forEach(function(a){var b="on"+a;CMControl.Element.prototype[b]=function(b){return this.dom.addEventListener(a.toLowerCase(),b,!1),this}}),CMControl.Panel=function(){CMControl.Element.call(this);var a=document.createElement("div");return a.style.userSelect="none",a.style.WebkitUserSelect="none",a.style.MozUserSelect="none",this.dom=a,this},CMControl.Panel.prototype=Object.create(CMControl.Element.prototype),CMControl.Panel.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.dom.appendChild(arguments[a].dom);return this},CMControl.TitleBar=function(a,b){CMControl.Element.call(this);var c=document.createElement("div");c.style.userSelect="none",c.style.WebkitUserSelect="none",c.style.MozUserSelect="none";var d=0,e=0,f=function(a){a.preventDefault(),l(a.pageX,a.pageY),document.addEventListener("mousemove",h,!1),document.addEventListener("mouseup",i,!1)},g=function(a){a.preventDefault();var b=a.touches[0];l(b.pageX,b.pageY),document.addEventListener("touchmove",j,!1),document.addEventListener("touchend",k,!1)},h=function(a){m(a.pageX,a.pageY)},i=function(a){document.removeEventListener("mousemove",h,!1),document.removeEventListener("mouseup",i,!1)},j=function(a){var b=a.touches[0];m(b.pageX,b.pageY)},k=function(a){document.removeEventListener("touchmove",j,!1),document.removeEventListener("touchend",k,!1)},l=function(b,c){d=b-a.dom.offsetLeft,e=c-a.dom.offsetTop},m=function(c,f){var g=c-d,h=f-e;a.dom.style.left=g+"px",a.dom.style.top=h+"px",b.moveControl.dispatch({x:g,y:h})};return c.addEventListener("mousedown",f,!1),CMControl.isTouch&&c.addEventListener("touchstart",g,!1),this.dom=c,this},CMControl.TitleBar.prototype=Object.create(CMControl.Element.prototype),CMControl.TitleBar.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.dom.appendChild(arguments[a].dom);return this},CMControl.Text=function(a){CMControl.Element.call(this);var b=document.createElement("span");return b.className="Text",b.style.cursor="default",b.style.display="inline-block",b.style.verticalAlign="top",this.dom=b,this.setValue(a),this},CMControl.Text.prototype=Object.create(CMControl.Element.prototype),CMControl.Text.prototype.setValue=function(a){return void 0!==a&&(this.dom.textContent=a),this},CMControl.File=function(){CMControl.Element.call(this);var a=this,b=document.createElement("input");return b.type="file",b.id="file-field",this.dom=b,this.onChangeCallback=null,this.dom.addEventListener("change",function(b){a.onChangeCallback&&a.onChangeCallback()},!1),this},CMControl.File.prototype=Object.create(CMControl.Element.prototype),CMControl.File.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.Input=function(){CMControl.Element.call(this);var a=this,b=document.createElement("input");return this.dom=b,this.onChangeCallback=null,this.dom.addEventListener("change",function(b){a.onChangeCallback&&a.onChangeCallback()},!1),this},CMControl.Input.prototype=Object.create(CMControl.Element.prototype),CMControl.Input.prototype.getValue=function(){return this.dom.value},CMControl.Input.prototype.setValue=function(a){return this.dom.value=a,this},CMControl.Input.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.TextArea=function(){CMControl.Element.call(this);var a=this,b=document.createElement("textarea");return b.className="TextArea",b.style.padding="2px",b.style.marginTop="-2px",b.style.marginLeft="-2px",b.style.border="1px solid #ccc",this.dom=b,this.onChangeCallback=null,this.dom.addEventListener("change",function(b){a.onChangeCallback&&a.onChangeCallback()},!1),this},CMControl.TextArea.prototype=Object.create(CMControl.Element.prototype),CMControl.TextArea.prototype.getValue=function(){return this.dom.value},CMControl.TextArea.prototype.setValue=function(a){return this.dom.value=a,this},CMControl.TextArea.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.Select=function(){CMControl.Element.call(this);var a=this,b=document.createElement("select");return b.className="Select",b.style.width="80px",b.style.height="16px",b.style.border="0px",b.style.padding="0px",this.dom=b,this.onChangeCallback=null,this.dom.addEventListener("change",function(b){a.onChangeCallback&&a.onChangeCallback()},!1),this},CMControl.Select.prototype=Object.create(CMControl.Element.prototype),CMControl.Select.prototype.setMultiple=function(a){return this.dom.multiple=a,this},CMControl.Select.prototype.setOptions=function(a){for(;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(var b in a){var c=document.createElement("option");c.value=b,c.innerHTML=a[b],this.dom.appendChild(c)}return this},CMControl.Select.prototype.getValue=function(){return this.dom.value},CMControl.Select.prototype.setValue=function(a){return this.dom.value=a,this},CMControl.Select.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.FancySelect=function(){CMControl.Element.call(this);var b=document.createElement("div");return b.className="FancySelect",b.style.background="#fff",b.style.border="1px solid #ccc",b.style.padding="0",b.style.cursor="default",b.style.overflow="auto",this.dom=b,this.onChangeCallback=null,this.options=[],this.selectedValue=null,this},CMControl.FancySelect.prototype=Object.create(CMControl.Element.prototype),CMControl.FancySelect.prototype.setOptions=function(a){for(var b=this;b.dom.children.length>0;)b.dom.removeChild(b.dom.firstChild);b.options=[];var c=function(a,c){return function(d){for(var e=0;e<b.options.length;e++)b.options[e].style.backgroundColor="#f0f0f0";a.style.backgroundColor="#f0f0f0",b.selectedValue=c,b.onChangeCallback&&b.onChangeCallback()}};for(var d in a){var e=document.createElement("div");e.style.padding="4px",e.style.whiteSpace="nowrap",e.innerHTML=a[d],e.value=d,b.dom.appendChild(e),b.options.push(e),e.addEventListener("click",c(e,d),!1)}return b},CMControl.FancySelect.prototype.getValue=function(){return this.selectedValue},CMControl.FancySelect.prototype.setValue=function(a){for(var b=a?a.toString():a,c=0;c<this.options.length;c++){var d=this.options[c];d.value===b?d.style.backgroundColor="#f0f0f0":d.style.backgroundColor=""}return this.selectedValue=a,this},CMControl.FancySelect.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.Checkbox=function(a){CMControl.Element.call(this);var b=this,c=document.createElement("input");return c.className="Checkbox",c.type="checkbox",this.dom=c,this.setValue(a),this.onChangeCallback=null,this.dom.addEventListener("change",function(a){b.onChangeCallback&&b.onChangeCallback()},!1),this},CMControl.Checkbox.prototype=Object.create(CMControl.Element.prototype),CMControl.Checkbox.prototype.getValue=function(){return this.dom.checked},CMControl.Checkbox.prototype.setValue=function(a){return void 0!==a&&(this.dom.checked=a),this},CMControl.Checkbox.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.Radio=function(a){CMControl.Element.call(this);var b=this,c=document.createElement("input");return c.className="Radio",c.type="radio",this.dom=c,this.setValue(a),this.onChangeCallback=null,this.dom.addEventListener("change",function(a){b.onChangeCallback&&b.onChangeCallback()},!1),this},CMControl.Radio.prototype=Object.create(CMControl.Element.prototype),CMControl.Radio.prototype.getValue=function(){return this.dom.checked},CMControl.Radio.prototype.setValue=function(a){return void 0!==a&&(this.dom.checked=a),this},CMControl.Radio.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.Color=function(){CMControl.Element.call(this);var a=this,b=document.createElement("input");return b.className="Color",b.style.width="64px",b.style.height="16px",b.style.border="0px",b.style.padding="0px",b.style.backgroundColor="transparent",b.type="color",this.dom=b,this.onChangeCallback=null,this.dom.addEventListener("change",function(b){a.onChangeCallback&&a.onChangeCallback()},!1),this},CMControl.Color.prototype=Object.create(CMControl.Element.prototype),CMControl.Color.prototype.getValue=function(){return this.dom.value},CMControl.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)},CMControl.Color.prototype.setValue=function(a){return this.dom.value=a,this},CMControl.Color.prototype.setHexValue=function(a){return this.dom.value="#"+("000000"+a.toString(16)).slice(-6),this},CMControl.Color.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.Number=function(a){CMControl.Element.call(this);var b=this,c=document.createElement("input");c.className="Number",c.style.backgroundColor="transparent",c.style.border="1px solid transparent",c.style.marginTop="-2px",c.style.marginLegt="-2px",c.style.padding="2px",c.style.cursor="col-resize",c.value="0.00",this.dom=c,this.setValue(a),this.min=-(1/0),this.max=1/0,this.precision=2,this.step=1,this.onChangeCallback=null;var d=0,e=0,f=function(a){a.preventDefault(),d=0,e=parseFloat(c.value),document.addEventListener("mousemove",g,!1),document.addEventListener("mouseup",h,!1)},g=function(a){var f=a.movementX||a.webkitMovementX||a.mozMovementX||0,g=a.movementY||a.webkitMovementY||a.mozMovementY||0;d+=f-g;var h=e+d/(a.shiftKey?10:100)*b.step;c.value=Math.min(b.max,Math.max(b.min,h)).toFixed(b.precision),b.onChangeCallback&&b.onChangeCallback()},h=function(a){document.removeEventListener("mousemove",g,!1),document.removeEventListener("mouseup",h,!1),Math.abs(d)<2&&(c.focus(),c.select())},i=function(a){var d=parseFloat(c.value);isNaN(d)===!1&&(c.value=d,b.onChangeCallback&&b.onChangeCallback())},j=function(a){c.style.backgroundColor="",c.style.borderColor="#ccc",c.style.cursor=""},k=function(a){c.style.backgroundColor="transparent",c.style.borderColor="transparent",c.style.cursor="col-resize"};return c.addEventListener("mousedown",f,!1),c.addEventListener("change",i,!1),c.addEventListener("focus",j,!1),c.addEventListener("blur",k,!1),this},CMControl.Number.prototype=Object.create(CMControl.Element.prototype),CMControl.Number.prototype.getValue=function(){return parseFloat(this.dom.value)},CMControl.Number.prototype.setValue=function(a){return void 0!==a&&(this.dom.value=a.toFixed(this.precision)),this},CMControl.Number.prototype.setRange=function(a,b){return this.min=a,this.max=b,this},CMControl.Number.prototype.setPrecision=function(a){return this.precision=a,a>2&&(this.step=Math.pow(10,-(a-1))),this},CMControl.Number.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.Break=function(){CMControl.Element.call(this);var a=document.createElement("br");return a.className="Break",this.dom=a,this},CMControl.Break.prototype=Object.create(CMControl.Element.prototype),CMControl.HorizontalRule=function(){CMControl.Element.call(this);var a=document.createElement("hr");return a.className="HorizontalRule",this.dom=a,this},CMControl.HorizontalRule.prototype=Object.create(CMControl.Element.prototype),CMControl.Button=function(){CMControl.Element.call(this);var a=this,b=document.createElement("button");return b.className="Button",this.dom=b,this.onClickCallback=null,this.dom.addEventListener("click",function(b){a.onClickCallback()},!1),this},CMControl.Button.prototype=Object.create(CMControl.Element.prototype),CMControl.Button.prototype.setLabel=function(a){return this.dom.textContent=a,this},CMControl.Button.prototype.onClick=function(a){return this.onClickCallback=a,this},CMControl.Slide=function(a){CMControl.Element.call(this);var b=document.createElement("div");b.className="slide",b.style.userSelect="none",b.style.WebkitUserSelect="none",b.style.MozUserSelect="none",this.dom=b;var c=document.createElement("div");c.className="handle my-over",b.appendChild(c);var e,f,d=this,g=0,h=a,i=this;this.max=0,this.handle=c,this.gap=40,setTimeout(function(){g=c.offsetWidth,i.max=b.offsetWidth-g;var a=0|CMControl.getCurrent(h,0,1,0,i.max);c.style.left=a+"px",c.style.display="none",setTimeout(function(){c.style.display="block"},0)},0);var j=function(a){a.preventDefault(),e=0,f=parseFloat(b.value),document.addEventListener("touchmove",n,!1),document.addEventListener("touchend",o,!1)},k=function(a){a.preventDefault(),e=0,f=parseFloat(b.value),document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",m,!1)},l=function(a){p(a.pageX,a.pageY)},m=function(a){document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",m,!1)},n=function(a){var b=a.touches[0];p(b.pageX,b.pageY)},o=function(a){document.removeEventListener("touchmove",n,!1),document.removeEventListener("touchend",o,!1)},p=function(a,b){var e=a-i.gap;e<0?e=0:e>i.max&&(e=i.max),c.style.left=e+"px";var f=CMControl.getCurrent(e,0,i.max,0,1);d.onChangeCallback&&d.onChangeCallback(f)};return c.addEventListener("mousedown",k,!1),CMControl.isTouch&&c.addEventListener("touchstart",j,!1),this},CMControl.Slide.prototype=Object.create(CMControl.Element.prototype),CMControl.Slide.prototype.onChange=function(a){return this.onChangeCallback=a,this},CMControl.Slide.prototype.setGap=function(a){this.gap=a+20},CMControl.Slide.prototype.setHandlePos=function(a){var b=CMControl.getCurrent(a,0,1,0,this.max);this.handle.style.left=b+"px"};